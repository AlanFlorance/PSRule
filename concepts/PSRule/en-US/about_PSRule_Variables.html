<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>PSRule_Variables </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="PSRule_Variables ">
    <meta name="generator" content="docfx 2.43.2.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../../commands/PSRule/en-US/toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="psrule_variables">PSRule_Variables</h1>

<h2 id="about_psrule_variables">about_PSRule_Variables</h2>
<h2 id="short-description">SHORT DESCRIPTION</h2>
<p>Describes the automatic variables that can be used within PSRule rule definitions.</p>
<h2 id="long-description">LONG DESCRIPTION</h2>
<p>PSRule lets you define rules using PowerShell blocks. A rule is defined within script files by using the <code>rule</code> keyword.</p>
<p>Within a rule definition, PSRule exposes a number of automatic variables that can be read to assist with rule execution.
Overwriting these variables or variable properties is not supported.</p>
<p>These variables are only available while <code>Invoke-PSRule</code> is executing.</p>
<p>The following variables are available for use:</p>
<ul>
<li><a href="#assert">$Assert</a></li>
<li><a href="#configuration">$Configuration</a></li>
<li><a href="#localizeddata">$LocalizedData</a></li>
<li><a href="#psrule">$PSRule</a></li>
<li><a href="#rule">$Rule</a></li>
<li><a href="#targetobject">$TargetObject</a></li>
</ul>
<h3 id="assert">Assert</h3>
<p>An assertion helper with methods to evaluate objects. The <code>$Assert</code> object provides a set of built-in methods and provides a consistent variable for extension.</p>
<p>Each <code>$Assert</code> method returns an <code>AssertResult</code> object that contains the result of the condition.</p>
<p>The following built-in assertion methods are provided:</p>
<ul>
<li><code>Contains</code> - The field value must contain at least one of the strings.</li>
<li><code>EndsWith</code> - The field value must match at least one suffix.</li>
<li><code>HasDefaultValue</code> - The object should not have the field or the field value is set to the default value.</li>
<li><code>HasField</code> - Asserts that the object must have the specified field.</li>
<li><code>HasFieldValue</code> - Asserts that the object must have the specified field and that field is not empty.</li>
<li><code>JsonSchema</code> - Asserts that the object must validate successfully against a JSON schema.</li>
<li><code>NullOrEmpty</code> - Asserts that the object must not have the specified field or it must be empty.</li>
<li><code>StartsWith</code> - The field value must match at least one prefix.</li>
<li><code>Version</code> - The field value must be a semantic version string.</li>
</ul>
<p>The <code>$Assert</code> variable can only be used within a rule definition block.</p>
<p>For detailed information on the assertion helper see <a href="about_PSRule_Assert.html">about_PSRule_Assert</a>.</p>
<p>Syntax:</p>
<pre><code class="lang-powershell">$Assert
</code></pre>
<p>Examples:</p>
<pre><code class="lang-powershell"># Synopsis: Determine if $TargetObject is valid against the provided schema
Rule 'UseJsonSchema' {
    $Assert.JsonSchema($TargetObject, 'schemas/PSRule-options.schema.json')
}
</code></pre>
<h3 id="configuration">Configuration</h3>
<p>A dynamic object with properties names that map to configuration values set in the baseline.</p>
<p>When accessing configuration:</p>
<ul>
<li>Configuration keys are case sensitive.</li>
<li>Configuration values are read only.</li>
<li>Configuration values can be accessed through helper methods.</li>
</ul>
<p>The following helper methods are available:</p>
<ul>
<li><code>GetStringValues(string configurationKey)</code> - Returns an array of strings, based on <code>configurationKey</code>.</li>
</ul>
<p>Syntax:</p>
<pre><code class="lang-powershell">$Configuration.&lt;configurationKey&gt;
</code></pre>
<pre><code class="lang-powershell">$Configuration.GetStringValues(&lt;configurationKey&gt;)
</code></pre>
<p>Examples:</p>
<pre><code class="lang-powershell"># Synopsis: This rule uses a threshold stored as $Configuration.appServiceMinInstanceCount
Rule 'appServicePlan.MinInstanceCount' -If { $TargetObject.ResourceType -eq 'Microsoft.Web/serverfarms' } {
    $TargetObject.Sku.capacity -ge $Configuration.appServiceMinInstanceCount
} -Configure @{ appServiceMinInstanceCount = 2 }
</code></pre>
<h3 id="localizeddata">LocalizedData</h3>
<p>A dynamic object with properties names that map to localized data messages in a <code>.psd1</code> file.</p>
<p>When using localized data, PSRule loads localized strings as a hashtable from <code>PSRule-rules.psd1</code>.</p>
<p>The following logic is used to locate <code>PSRule-rules.psd1</code>:</p>
<ul>
<li>If the rules are loose (not part of a module), PSRule will search for <code>PSRule-rules.psd1</code> in the <code>.\&lt;culture&gt;\</code> subdirectory relative to where the rule script <em>.ps1</em> file is located.</li>
<li>When the rules are shipped as part of a module, PSRule will search for <code>PSRule-rules.psd1</code> in the <code>.\&lt;culture&gt;\</code> subdirectory relative to where the module manifest <em>.psd1</em> file is located.</li>
</ul>
<p>When accessing localized data:</p>
<ul>
<li>Message names are case sensitive.</li>
<li>Message values are read only.</li>
</ul>
<p>Syntax:</p>
<pre><code class="lang-powershell">$LocalizedData.&lt;messageName&gt;
</code></pre>
<p>Examples:</p>
<pre><code class="lang-powershell"># Data for rules stored in PSRule-rules.psd1
@{
    WithLocalizedDataMessage = 'LocalizedMessage for en-ZZ. Format={0}.'
}
</code></pre>
<pre><code class="lang-powershell"># Synopsis: Use -f to generate a formatted localized warning
Rule 'WithLocalizedData' {
    Write-Warning -Message ($LocalizedData.WithLocalizedDataMessage -f $TargetObject.Type)
}
</code></pre>
<p>This rule returns a warning message similar to:</p>
<pre><code class="lang-text">LocalizedMessage for en-ZZ. Format=TestType.
</code></pre>
<h3 id="psrule">PSRule</h3>
<p>An object representing the current context during execution.</p>
<p>The following properties are available for read access:</p>
<ul>
<li><code>Field</code> - A hashtable of custom bound fields. See option <code>Binding.Field</code> for more information.</li>
<li><code>TargetObject</code> - The object currently being processed on the pipeline.</li>
<li><code>TargetName</code> - The name of the object currently being processed on the pipeline.
This property will automatically default to <code>TargetName</code> or <code>Name</code> properties of the object if they exist.</li>
<li><code>TargetType</code> - The type of the object currently being processed on the pipeline.
This property will automatically bind to <code>PSObject.TypeNames[0]</code> by default.</li>
</ul>
<p>The following properties are available for read/ write access:</p>
<ul>
<li><code>Data</code> - A hashtable of custom data. This property can be populated during rule execution.
Custom data is not used by PSRule directly, and is intended to be used by downstream processes that need to interpret PSRule results.</li>
</ul>
<p>To bind fields that already exist on the target object use custom binding and <code>Binding.Field</code>.
Use custom data to store data that must be calculated during rule execution.</p>
<p>The following helper methods are available:</p>
<ul>
<li><code>GetContent(PSObject sourceObject)</code> - Returns the content of a file as one or more objects.
The parameter <code>sourceObject</code> should be a <code>FileInfo</code> or a <code>Uri</code> object.
The file format is detected based on the same file formats as the option <code>Input.Format</code>.
i.e. Yaml, Json, Markdown and PowerShell Data.</li>
</ul>
<p>Syntax:</p>
<pre><code class="lang-powershell">$PSRule
</code></pre>
<p>Examples:</p>
<pre><code class="lang-powershell"># Synopsis: This rule determines if the target object matches the naming convention
Rule 'NamingConvention' {
    $PSRule.TargetName.ToLower() -ceq $PSRule.TargetName
}
</code></pre>
<pre><code class="lang-powershell"># Synopsis: Use allowed environment tags
Rule 'CustomData' {
    Recommend 'Environment must be set to an allowed value'
    Within 'Tags.environment' 'production', 'test', 'development'

    if ($TargetObject.Tags.environment -in 'prod') {
        $PSRule.Data['targetEnvironment'] = 'production'
    }
    elseif ($TargetObject.Tags.environment -in 'dev', 'develop') {
        $PSRule.Data['targetEnvironment'] = 'development'
    }
    elseif ($TargetObject.Tags.environment -in 'tst', 'testing') {
        $PSRule.Data['targetEnvironment'] = 'test'
    }
}
</code></pre>
<h3 id="rule">Rule</h3>
<p>An object representing the current rule during execution.</p>
<p>The following properties are available for read access:</p>
<ul>
<li><code>RuleName</code> - The name of the rule.</li>
<li><code>RuleId</code> - A unique identifier for the rule.</li>
<li><code>TargetObject</code> - (deprecated) The object currently being processed on the pipeline.</li>
<li><code>TargetName</code> - (deprecated) The name of the object currently being processed on the pipeline. This property will automatically default to <code>TargetName</code> or <code>Name</code> properties of the object if they exist.</li>
<li><code>TargetType</code> - (deprecated) The type of the object currently being processed on the pipeline. This property will automatically bind to <code>PSObject.TypeNames[0]</code> by default.</li>
</ul>
<p><strong>Note:</strong> Use <code>TargetName</code>, <code>TargetType</code> and <code>TargetObject</code> on <code>$PSRule</code> instead.</p>
<p>Syntax:</p>
<pre><code class="lang-powershell">$Rule
</code></pre>
<p>Examples:</p>
<pre><code class="lang-powershell"># Synopsis: This rule determines if the target object matches the naming convention
Rule 'resource.NamingConvention' {
    $Rule.TargetName.ToLower() -ceq $Rule.TargetName
}
</code></pre>
<h3 id="targetobject">TargetObject</h3>
<p>The value of the pipeline object currently being processed. <code>$TargetObject</code> is set by using the <code>-InputObject</code> parameter of <code>Invoke-PSRule</code>.</p>
<p>When more than one input object is set, each object will be processed sequentially.</p>
<p>Syntax:</p>
<pre><code class="lang-powershell">$TargetObject
</code></pre>
<p>Examples:</p>
<pre><code class="lang-powershell"># Synopsis: Check that sku capacity is set to at least 2
Rule 'HasMinInstances' {
    $TargetObject.Sku.capacity -ge 2
}
</code></pre>
<h2 id="note">NOTE</h2>
<p>An online version of this document is available at <a href="https://github.com/Microsoft/PSRule/blob/master/docs/concepts/PSRule/en-US/about_PSRule_Variables.md">https://github.com/Microsoft/PSRule/blob/master/docs/concepts/PSRule/en-US/about_PSRule_Variables.md</a>.</p>
<h2 id="see-also">SEE ALSO</h2>
<ul>
<li><a href="https://github.com/Microsoft/PSRule/blob/master/docs/commands/PSRule/en-US/Invoke-PSRule.md">Invoke-PSRule</a></li>
</ul>
<h2 id="keywords">KEYWORDS</h2>
<ul>
<li>Assert</li>
<li>Configuration</li>
<li>LocalizedData</li>
<li>PSRule</li>
<li>Rule</li>
<li>TargetObject</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/Microsoft/PSRule/blob/master/docs/concepts/PSRule/en-US/about_PSRule_Variables.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
